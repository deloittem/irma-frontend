<div class="header-section">
    <p><a href="/scan/{{state.scan.id}}">Back to the scan summary</a></p>
    <h2 id="file-informations">File informations</h2>
	<tags-input 
            ng-model="tags"
            on-tag-added="tagAdded($tag)"
            on-tag-removed="tagRemoved($tag)"
            add-from-autocomplete-only="true">
            <auto-complete
                    load-on-down-arrow="true"
                    load-on-empty="true"
                    load-on-focus="true"
                    min-length="0"
                    source="loadAvailableTags($query)">
            </auto-complete>
    </tags-input>
    <table class="table table-bordered">
        <tbody>
        <tr>
            <th style="vertical-align: middle">Filename</th>
            <td>{{vm.results.name}}
                <a target="_self" href="{{vm.downloadUrl}}" download="{{vm.results.name}}">
                    <button type="button" class="btn btn-success btn-s button-download">
                        <span class="glyphicon glyphicon-download"></span>
                    </button>
            </td>
        </tr>
        <tr>
            <th>Size (bytes)</th>
            <td>{{vm.results.file_infos.size}}</td>
        </tr>
		<tr>
            <th>Mimetype</th>
            <td>{{vm.results.file_infos.mimetype}}</td>
        </tr>
        <tr>
            <th>MD5</th>
            <td>{{vm.results.file_infos.md5}}</td>
        </tr>
        <tr>
            <th>SHA1</th>
            <td>{{vm.results.file_infos.sha1}}</td>
        </tr>
        <tr>
            <th>SHA256</th>
            <td>{{vm.results.file_infos.sha256}}</td>
        </tr>
        <tr>
            <th>First Scan</th>
            <td>{{vm.results.file_infos.timestamp_first_scan | amDateFormat:'lll'}}</td>
        </tr>
        <tr>
            <th>Last Scan</th>
            <td>{{vm.results.file_infos.timestamp_last_scan | amDateFormat:'lll'}}</td>
        </tr>
        </tbody>
    </table>
    <form ng-submit="vm.rescan()">
        <ul class="list-inline probes-list">
            <li ng-repeat="probe in probesDoneButNotExist" class=''>
                <span boolean-display="true" color='#000'></span> {{probe}}
            </li>
            <li ng-repeat="probe in state.probes" ng-click="probe.active = !probe.active" class="{{(probe.active)? 'active': ''}}">
                <span boolean-display="probe.active" color="{{(probe.active)? '#fff': '#999'}}"></span> {{probe.name}}
            </li>
        </ul>
        <p>
            <input type="submit" class="action btn btn-lg btn-success" value="Rescan" ng-disabled="state.noActiveProbes()">
        </p>
    </form>
</div>
<tabset>
    <tab heading="Analyses">
        <div class="result-section">
            <div ng-show="probesAntivirus.length">
                <h2 id="antivirus">Antivirus</h2>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Result</th>
                        <th>Version</th>
                        <th>Duration (in secs)</th>
                    </tr>
                    </thead>
                    <tbody>
              			<tr ng-repeat="output in probesAntivirus = (vm.results.probe_results | filter:{type:'antivirus'})" ng-class="(output.status == 0) ? 'success' : (output.status == 1) ? 'danger' : 'warning' ">
                			<th>{{output.name}}</th>
                			<td ng-if="output.status == 1">{{output.results}}</td>
                			<td ng-if="output.status == 0"></td>
                			<td ng-if="output.status == -1"><i style="text-align: center;" class="glyphicon glyphicon-exclamation-sign" title="Antivirus scan ended up in an error state :("></i></td>
                			<td>{{output.version}}</td>
                			<td>{{output.duration}}</td>
              			</tr>
            		</tbody>
                </table>
            </div>

            <div ng-show="probesMetadata.length">
                <h2 id="metadata">Metadata</h2>
          		<h3 ng-repeat-start="output in probesMetadata = (vm.results.probe_results | filter:{type:'metadata'})" id="{{output.name | lowercase}}">{{output.name}} <small>{{output.version}}</small></h3>
          		<h5>Responded in {{output.duration}} s</h5>

                <div ng-switch on="output.status" ng-repeat-end>
                    <div ng-switch-when="1">
                        <div ng-switch on="output.name">
                            <pre ng-switch-when="StaticAnalyzer"><json-formatter json="output.results"
                                                                                 open="1"></json-formatter></pre>
                            <table class="table table-bordered" ng-switch-when="TrID">
                                <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>File Extension</th>
                                    <th>Ration (in %)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="(id, output) in output.results">
                                    <td>{{output.desc}}</td>
                                    <td>{{output.ext}}</td>
                                    <td>{{output.ratio}}</td>
                                </tr>
                                </tbody>
                            </table>
                            <pre ng-switch-default>{{output.results}}</pre>
                        </div>
                    </div>

                    <div ng-switch-when="0" class="bs-callout bs-callout-warning">
                        <h4>Warning:</h4>
                        <samp>"{{output.results}}"</samp>
                    </div>

                    <div ng-switch-when="-1" class="bs-callout bs-callout-danger">
                        <h4>Error:</h4>
                        <samp>"{{output.error}}"</samp>
                    </div>
                </div>
            </div>


            <div ng-show="probesExternal.length">
                <h2 id="external">External</h2>
          		<h3 ng-repeat-start="output in probesExternal = (vm.results.probe_results | filter:{type:'external'})" id="{{output.name | lowercase}}">{{output.name}} <small>{{output.version}}</small></h3>
          		<h5>Responded in {{output.duration}} s</h5>
          		<h5 ng-show="output.external_url">Full result is available <a href="{{output.external_url}}">here <span class="glyphicon glyphicon-new-window"></span></a>.</h5>

                <div ng-switch on="output.status" ng-repeat-end>
                    <pre ng-switch-when="1">{{output.results}}</pre>

                    <div ng-switch-when="0" class="bs-callout bs-callout-warning">
                        <h4>Warning:</h4>
                        <samp>"{{output.results}}"</samp>
                    </div>

                    <div ng-switch-when="-1" class="bs-callout bs-callout-danger">
                        <h4>Error:</h4>
                        <samp>"{{output.error}}"</samp>
                    </div>
                </div>
            </div>


            <div ng-show="probesDatabase.length">
                <h2 id="database">Database</h2>
         		<h3 ng-repeat-start="output in probesDatabase = (vm.results.probe_results | filter:{type:'database'})" id="{{output.name | lowercase}}">{{output.name}} <small>{{output.version}}</small></h3>
          		<h5>Responded in {{output.duration}} s</h5>

                <div ng-switch on="output.status" ng-repeat-end>
                    <div ng-switch-when="-1" class="bs-callout bs-callout-danger">
                        <h4>Error:</h4>
                        <samp>"{{output.error}}"</samp>
                    </div>

                    <pre ng-switch-default>{{output.results}}</pre>
                </div>
            </div>
        </div>
    </tab>
    <tab heading="Attachments">
        <div class="attachments-section">
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-bordered table-attachment">
                        <tbody>
                        <tr ng-repeat="attachment in vm.attachmentList">
                            <td style="width:75%;vertical-align: middle;overflow: hidden;
    text-overflow: ellipsis;">{{attachment}}</td>
                            <td class="attachment-download">
                                <a target="_self" href="/attachments/{{vm.results.file_infos.sha256}}/{{attachment}}" download="{{attachment}}">
                                    <button type="button" class="btn btn-success btn-s">
                                        <span class="glyphicon glyphicon-download"></span>
                                    </button>
                            </td>
                            <td class="attachment-delete">
                                <button type="button" class="btn btn-danger btn-s" ng-click="vm.deleteAttachment(attachment)">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6 files">
                    <div>
                        <ul class="list-inline upload-button-list">
                            <li>
                                <button type="button" class="btn btn-success btn-s" ng-click="vm.uploadAttachment()" ng-disabled="!vm.uploader.getNotUploadedItems().length">
                                    <span class="glyphicon glyphicon-upload"></span> Upload
                                </button>
                            </li>
                            <li>
                                <button type="button" class="btn btn-warning btn-s" ng-click="vm.uploader.cancelAll()" ng-disabled="!vm.uploader.isUploading">
                                    <span class="glyphicon glyphicon-ban-circle"></span> Cancel
                                </button>
                            </li>
                            <li>
                                <button type="button" class="btn btn-danger btn-s" ng-click="vm.uploader.clearQueue()" ng-disabled="!vm.uploader.queue.length">
                                    <span class="glyphicon glyphicon-trash"></span> Reset
                                </button>
                            </li>
                        </ul>
                        <div class="progress" style="">
                            <div class="progress-bar" role="progressbar" ng-style="{ 'width': vm.uploader.progress + '%' }"></div>
                        </div>
                        <input type="file" nv-file-select="" uploader="vm.uploader"/>
                    </div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th width="50%">Name</th>
                            <th ng-show="vm.uploader.isHTML5">Size</th>
                            <th ng-show="vm.uploader.isHTML5">Progress</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in vm.uploader.queue">
                            <td><strong>{{ item.file.name }}</strong></td>
                            <td ng-show="vm.uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td>
                            <td ng-show="vm.uploader.isHTML5">
                                <div class="progress" style="margin-bottom: 0;">
                                    <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
                                </div>
                            </td>
                            <td class="text-center">
                                <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                                <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                                <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                            </td>
                            <td nowrap>
                                <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                    <span class="glyphicon glyphicon-trash"></span> Remove
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </tab>
</tabset>

